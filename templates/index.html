<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Background Remover</title>
</head>
<body>
    <h1>Background Remover</h1>
    <form enctype="multipart/form-data">
        <input type="file" name="image" accept="image/*" required>
        <button type="submit">Remove Background</button>
    </form>

    <!-- Progress Bar -->
    <div id="progress-container" style="display:none; margin-top: 20px;">
        <label>Removing background...</label>
        <progress id="progress-bar" value="0" max="100" style="width: 100%;"></progress>
    </div>

    <!-- Result -->
    <div id="result" style="margin-top: 20px;"></div>

    <script>
        document.querySelector('form').onsubmit = async function(event) {
            event.preventDefault();
            const formData = new FormData(this);

            const progressBar = document.getElementById("progress-bar");
            const progressContainer = document.getElementById("progress-container");
            const resultDiv = document.getElementById("result");

            // Reset progress
            progressBar.value = 0;
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '';

            // Simulate progress bar
            let simulatedProgress = 0;
            const interval = setInterval(() => {
                if (simulatedProgress < 95) {
                    simulatedProgress += Math.floor(Math.random() * 5) + 1;
                    progressBar.value = simulatedProgress;
                }
            }, 200);

            try {
                const response = await fetch('/remove-bg', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error("Something went wrong!");
                }

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const img = document.createElement('img');
                img.src = url;
                img.style.maxWidth = "100%";

                // Show result image
                clearInterval(interval);
                progressBar.value = 100;
                resultDiv.appendChild(img);

                // Trigger automatic download
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = 'background_removed.png';
                downloadLink.click();

            } catch (error) {
                clearInterval(interval);
                alert("Error: " + error.message);
            }
        };
    </script>
</body>
</html>
